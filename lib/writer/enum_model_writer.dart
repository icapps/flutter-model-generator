import 'package:model_generator/model/item_type/double_type.dart';
import 'package:model_generator/model/item_type/string_type.dart';
import 'package:model_generator/model/model/enum_model.dart';
import 'package:model_generator/util/case_util.dart';
import 'package:model_generator/util/list_extensions.dart';
import 'package:model_generator/writer/object_model_writer.dart';

class EnumModelWriter {
  final EnumModel jsonModel;

  const EnumModelWriter(this.jsonModel);

  String write() {
    final sb = StringBuffer()
      ..writeln(ObjectModelWriter.autoGeneratedWarning)
      ..writeln()
      ..writeln("import 'package:json_annotation/json_annotation.dart';")
      ..writeln();

    final modelDescription = jsonModel.description?.trim();
    if (modelDescription != null && modelDescription.isNotEmpty) {
      sb.writeln("///$modelDescription");
    }

    final jsonModelName = CaseUtil(jsonModel.name);

    sb.writeln('enum ${jsonModelName.pascalCase} {');
    jsonModel.fields?.forEach((key) {
      final keyProperty = key.enumProperties.firstWhereOrNull((element) => element.name.toLowerCase() == jsonModel.keyProperty);
      final jsonValue = keyProperty?.value ?? key.serializedName;
      final propertyType = keyProperty?.type;

      if (propertyType is StringType || propertyType == null) {
        sb.writeln('  @JsonValue(\'$jsonValue\')');
      } else if (propertyType is DoubleType) {
        final doubleValue = double.tryParse(jsonValue);
        sb.writeln('  @JsonValue($doubleValue)');
      } else {
        sb.writeln('  @JsonValue($jsonValue)');
      }
      sb.writeln('  ${key.name},');
    });
    sb.writeln('}');

    return sb.toString();
  }
}
